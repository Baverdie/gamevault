generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

model User {
	id        String   @id @default(uuid())
	email     String   @unique
	username  String   @unique
	password  String
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt

	games     Game[]   @relation("UserGames")
	userGames UserGame[]
	reviews   Review[]

	@@map("users")
}

model Game {
	id          String   @id @default(uuid())
	rawgId      Int      @unique
	name        String
	slug        String
	description String?  @db.Text
	released    DateTime?
	rating      Float?
	metacritic  Int?
	imageUrl    String?
	genres      String[] // Array of genre names
	platforms   String[] // Array of platform names

	createdAt   DateTime @default(now())
	updatedAt   DateTime @updatedAt

	users       User[]   @relation("UserGames")

	userGames   UserGame[]
	reviews     Review[]

	@@map("games")
}

model UserGame {
	id         String   @id @default(uuid())
	userId     String
	gameId     String
	status     GameStatus @default(BACKLOG)
	playtime   Int?     // in hours
	addedAt    DateTime @default(now())
	updatedAt  DateTime @updatedAt

	user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
	game       Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)

	@@unique([userId, gameId])
	@@map("user_games")
}

model Review {
	id        String   @id @default(uuid())
	userId    String
	gameId    String
	rating    Int      // 1-10
	content   String?  @db.Text
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt

	user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
	game      Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)

	@@unique([userId, gameId])
	@@map("reviews")
}

enum GameStatus {
	BACKLOG
	PLAYING
	COMPLETED
	DROPPED
}